<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detalle del Caso</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

    <!-- NAV -->
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <a href="/Tabla_Gestor" class="navbar-brand">‚Üê Volver</a>
            <span class="navbar-text text-white">Detalle del Caso</span>
        </div>
    </nav>

    <div class="container mt-4">

        <div class="card p-3">
            <h4>Datos del Cliente</h4>
            <p><strong>RUT:</strong> <%= caso.rut_cliente %></p>
            <p><strong>Nombre:</strong> <%= caso.nombre_cliente %></p>
            <p><strong>Correo:</strong> <%= caso.correo_cliente %></p>
            <p>
                <strong>Estado:</strong>
                <% if (caso.estado) { %>
                    <span class="badge bg-success">Activo</span>
                <% } else { %>
                    <span class="badge bg-danger">Cerrado</span>
                <% } %>
            </p>
        </div>

        <hr>

        <h4>Historial de Detalles</h4>

        <ul class="list-group mb-4">
            <% if (detalles.length === 0) { %>
                <li class="list-group-item">Sin detalles registrados.</li>
            <% } %>

            <% detalles.forEach(d => { %>
            <div class="timeline-item">
                <h6 class="mb-1">
                    <%= d.detalle %>
                </h6>

                <span>üìÖ <%= d.fecha.toISOString().split("T")[0] %></span>

                <!-- BOT√ìN ELIMINAR DETALLE -->
                <a href="/detalle/eliminar/<%= d.id_detalles %>?rut=<%= caso.rut_cliente %>"
                class="btn btn-sm btn-danger"
                onclick="return confirm('¬øEliminar este detalle?');">
                    Eliminar
                </a>

            </div>
            <% }); %>

        </ul>

        <div class="card p-3">
            <h5>Agregar nuevo detalle</h5>

            <form method="POST" action="/detalle/agregar">
                <input type="hidden" name="rut_cliente" value="<%= caso.rut_cliente %>">

                <div class="mb-3">
                    <label class="form-label">Descripci√≥n</label>
                    <textarea name="descripcion" class="form-control" required></textarea>
                </div>

                <input type="hidden" name="usuario_id" value="<%= usuario.id %>">

                <button class="btn btn-primary">Agregar</button>
            </form>
        </div>

    </div>

</body>
</html>
